"use strict";(globalThis.webpackChunkfrontend_book=globalThis.webpackChunkfrontend_book||[]).push([[8732],{2093(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=t(2540),s=t(3023);const r={title:"Python Agents for ROS 2",sidebar_position:1},i="Python Agents for ROS 2",o={id:"python-agents",title:"Python Agents for ROS 2",description:"Learning Objectives",source:"@site/docs/python-agents.md",sourceDirName:".",slug:"/python-agents",permalink:"/docs/python-agents",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/python-agents.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Python Agents for ROS 2",sidebar_position:1}},l={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Installing rclpy",id:"installing-rclpy",level:3},{value:"Creating Python AI Agents",id:"creating-python-ai-agents",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:3},{value:"Message Flow Between Agent and Controller",id:"message-flow-between-agent-and-controller",level:2},{value:"Publisher-Subscriber Pattern",id:"publisher-subscriber-pattern",level:3},{value:"Service-Based Communication",id:"service-based-communication",level:3},{value:"Advanced AI Agent Patterns",id:"advanced-ai-agent-patterns",level:2},{value:"State Machine Agent",id:"state-machine-agent",level:3},{value:"Behavior Tree Agent",id:"behavior-tree-agent",level:3},{value:"Integration with Machine Learning",id:"integration-with-machine-learning",level:2},{value:"TensorFlow/PyTorch Integration",id:"tensorflowpytorch-integration",level:3},{value:"Best Practices for Python AI Agents",id:"best-practices-for-python-ai-agents",level:2},{value:"1. Error Handling",id:"1-error-handling",level:3},{value:"2. Parameter Management",id:"2-parameter-management",level:3},{value:"3. Logging and Monitoring",id:"3-logging-and-monitoring",level:3},{value:"Testing AI Agents",id:"testing-ai-agents",level:2},{value:"Unit Testing",id:"unit-testing",level:3},{value:"Real-World Example: Navigation AI Agent",id:"real-world-example-navigation-ai-agent",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"python-agents-for-ros-2",children:"Python Agents for ROS 2"}),"\n",(0,a.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,a.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Interface Python AI agents with ROS 2 using rclpy"}),"\n",(0,a.jsx)(n.li,{children:"Design message flows between agents and robot controllers"}),"\n",(0,a.jsx)(n.li,{children:"Implement Python nodes that bridge AI algorithms with robot systems"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"rclpy"})," is the Python client library for ROS 2. It provides a Python API for creating ROS 2 nodes, publishers, subscribers, services, and actions."]}),"\n",(0,a.jsx)(n.h3,{id:"installing-rclpy",children:"Installing rclpy"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"rclpy"})," is typically installed as part of the ROS 2 Python development packages:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pip3 install rclpy\n# Or through ROS 2 installation\n"})}),"\n",(0,a.jsx)(n.h2,{id:"creating-python-ai-agents",children:"Creating Python AI Agents"}),"\n",(0,a.jsx)(n.h3,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,a.jsx)(n.p,{children:"Here's the basic structure of a Python AI agent node:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom sensor_msgs.msg import JointState\n\nclass PythonAIAgent(Node):\n    def __init__(self):\n        super().__init__('python_ai_agent')\n\n        # Create subscribers to receive data from robot\n        self.robot_state_subscriber = self.create_subscription(\n            JointState,\n            'joint_states',\n            self.robot_state_callback,\n            10\n        )\n\n        # Create publishers to send commands to robot\n        self.command_publisher = self.create_publisher(\n            String,\n            'ai_commands',\n            10\n        )\n\n        # Create timer for AI decision making\n        self.ai_timer = self.create_timer(0.1, self.ai_decision_callback)\n\n        self.get_logger().info('Python AI Agent initialized')\n\n    def robot_state_callback(self, msg):\n        \"\"\"Process robot state data and update AI internal state\"\"\"\n        self.get_logger().info(f'Received joint states: {len(msg.name)} joints')\n        # Process the robot state for AI decision making\n\n    def ai_decision_callback(self):\n        \"\"\"Main AI decision making function\"\"\"\n        # Implement AI logic here\n        command_msg = String()\n        command_msg.data = 'AI command: move_to_target'\n        self.command_publisher.publish(command_msg)\n        self.get_logger().info(f'Published: {command_msg.data}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    ai_agent = PythonAIAgent()\n\n    try:\n        rclpy.spin(ai_agent)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        ai_agent.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"message-flow-between-agent-and-controller",children:"Message Flow Between Agent and Controller"}),"\n",(0,a.jsx)(n.h3,{id:"publisher-subscriber-pattern",children:"Publisher-Subscriber Pattern"}),"\n",(0,a.jsx)(n.p,{children:"The most common pattern for AI agent to robot communication is using topics:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Robot controller publishes sensor data to topics"}),"\n",(0,a.jsx)(n.li,{children:"AI agent subscribes to sensor data topics"}),"\n",(0,a.jsx)(n.li,{children:"AI agent processes data and publishes commands to topics"}),"\n",(0,a.jsx)(n.li,{children:"Robot controller subscribes to command topics"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"service-based-communication",children:"Service-Based Communication"}),"\n",(0,a.jsx)(n.p,{children:"For synchronous communication, services can be used:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile\nfrom example_interfaces.srv import Trigger\n\nclass AIAgentWithServices(Node):\n    def __init__(self):\n        super().__init__('ai_agent_with_services')\n\n        # Create client for robot services\n        self.robot_service_client = self.create_client(\n            Trigger,\n            'robot_execute_action'\n        )\n\n    def call_robot_service(self):\n        \"\"\"Call robot service to execute an action\"\"\"\n        if self.robot_service_client.wait_for_service(timeout_sec=1.0):\n            request = Trigger.Request()\n            future = self.robot_service_client.call_async(request)\n            return future\n        else:\n            self.get_logger().error('Robot service not available')\n"})}),"\n",(0,a.jsx)(n.h2,{id:"advanced-ai-agent-patterns",children:"Advanced AI Agent Patterns"}),"\n",(0,a.jsx)(n.h3,{id:"state-machine-agent",children:"State Machine Agent"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from enum import Enum\n\nclass AgentState(Enum):\n    IDLE = 1\n    PLANNING = 2\n    EXECUTING = 3\n    ERROR = 4\n\nclass StateMachineAIAgent(Node):\n    def __init__(self):\n        super().__init__(\'state_machine_ai_agent\')\n        self.current_state = AgentState.IDLE\n\n        self.command_publisher = self.create_publisher(\n            String,\n            \'robot_commands\',\n            10\n        )\n\n        self.state_timer = self.create_timer(0.05, self.state_machine_callback)\n\n    def state_machine_callback(self):\n        """State machine for AI agent"""\n        if self.current_state == AgentState.IDLE:\n            # Check if we need to plan something\n            if self.should_plan():\n                self.current_state = AgentState.PLANNING\n        elif self.current_state == AgentState.PLANNING:\n            # Execute planning algorithm\n            plan = self.plan_action()\n            if plan:\n                self.current_state = AgentState.EXECUTING\n        elif self.current_state == AgentState.EXECUTING:\n            # Execute the plan\n            if self.is_plan_complete():\n                self.current_state = AgentState.IDLE\n        elif self.current_state == AgentState.ERROR:\n            # Handle error state\n            self.current_state = AgentState.IDLE\n'})}),"\n",(0,a.jsx)(n.h3,{id:"behavior-tree-agent",children:"Behavior Tree Agent"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class BehaviorNode:\n    def __init__(self, name):\n        self.name = name\n        self.parent = None\n        self.children = []\n\n    def tick(self):\n        """Execute the behavior and return status"""\n        pass\n\nclass SequenceNode(BehaviorNode):\n    def tick(self):\n        for child in self.children:\n            status = child.tick()\n            if status != \'SUCCESS\':\n                return status\n        return \'SUCCESS\'\n\nclass AIAgentWithBehaviorTree(Node):\n    def __init__(self):\n        super().__init__(\'ai_agent_behavior_tree\')\n\n        # Create behavior tree\n        self.root = SequenceNode(\'root\')\n        self.root.children = [\n            self.create_sensor_check_node(),\n            self.create_plan_node(),\n            self.create_execute_node()\n        ]\n\n        self.bt_timer = self.create_timer(0.1, self.behavior_tree_callback)\n\n    def behavior_tree_callback(self):\n        """Execute behavior tree"""\n        result = self.root.tick()\n        self.get_logger().info(f\'Behavior tree result: {result}\')\n'})}),"\n",(0,a.jsx)(n.h2,{id:"integration-with-machine-learning",children:"Integration with Machine Learning"}),"\n",(0,a.jsx)(n.h3,{id:"tensorflowpytorch-integration",children:"TensorFlow/PyTorch Integration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import tensorflow as tf\n# or\nimport torch\n\nclass MLIntegratedAIAgent(Node):\n    def __init__(self):\n        super().__init__(\'ml_integrated_ai_agent\')\n\n        # Load pre-trained model\n        self.model = self.load_model()\n\n        self.sensor_subscriber = self.create_subscription(\n            JointState,\n            \'joint_states\',\n            self.ml_decision_callback,\n            10\n        )\n\n    def load_model(self):\n        """Load pre-trained ML model"""\n        # Load your trained model here\n        # model = tf.keras.models.load_model(\'path/to/model\')\n        # or\n        # model = torch.load(\'path/to/model.pth\')\n        pass\n\n    def ml_decision_callback(self, msg):\n        """Use ML model for decision making"""\n        # Preprocess sensor data\n        input_data = self.preprocess_sensor_data(msg)\n\n        # Run inference\n        action = self.model.predict(input_data)\n\n        # Publish action\n        command_msg = String()\n        command_msg.data = f\'ML action: {action}\'\n        self.command_publisher.publish(command_msg)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices-for-python-ai-agents",children:"Best Practices for Python AI Agents"}),"\n",(0,a.jsx)(n.h3,{id:"1-error-handling",children:"1. Error Handling"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def safe_robot_command(self, command):\n    """Safely send command to robot with validation"""\n    try:\n        # Validate command before sending\n        if self.validate_command(command):\n            self.command_publisher.publish(command)\n        else:\n            self.get_logger().error(\'Invalid command rejected\')\n    except Exception as e:\n        self.get_logger().error(f\'Error sending command: {e}\')\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-parameter-management",children:"2. Parameter Management"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def __init__(self):\n    super().__init__('parameterized_ai_agent')\n\n    # Declare parameters\n    self.declare_parameter('max_velocity', 1.0)\n    self.declare_parameter('safety_threshold', 0.5)\n\n    # Access parameters\n    self.max_velocity = self.get_parameter('max_velocity').value\n    self.safety_threshold = self.get_parameter('safety_threshold').value\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-logging-and-monitoring",children:"3. Logging and Monitoring"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def log_agent_state(self):\n    \"\"\"Log important agent state information\"\"\"\n    self.get_logger().info(\n        f'Agent state - Position: {self.current_pos}, '\n        f'Goal: {self.current_goal}, '\n        f'Status: {self.status}'\n    )\n"})}),"\n",(0,a.jsx)(n.h2,{id:"testing-ai-agents",children:"Testing AI Agents"}),"\n",(0,a.jsx)(n.h3,{id:"unit-testing",children:"Unit Testing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import unittest\nfrom unittest.mock import Mock\nimport rclpy\nfrom rclpy.clock import Clock\nfrom std_msgs.msg import String\n\nclass TestAIAgent(unittest.TestCase):\n    def setUp(self):\n        rclpy.init()\n        self.ai_agent = PythonAIAgent()\n\n    def tearDown(self):\n        self.ai_agent.destroy_node()\n        rclpy.shutdown()\n\n    def test_command_publishing(self):\n        # Mock publisher\n        self.ai_agent.command_publisher = Mock()\n\n        # Call the method that publishes\n        self.ai_agent.ai_decision_callback()\n\n        # Verify that publish was called\n        self.ai_agent.command_publisher.publish.assert_called_once()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"real-world-example-navigation-ai-agent",children:"Real-World Example: Navigation AI Agent"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from geometry_msgs.msg import PoseStamped, Twist\nfrom nav_msgs.msg import Odometry\n\nclass NavigationAIAgent(Node):\n    def __init__(self):\n        super().__init__(\'navigation_ai_agent\')\n\n        # Publishers and subscribers\n        self.cmd_vel_publisher = self.create_publisher(\n            Twist,\n            \'cmd_vel\',\n            10\n        )\n\n        self.odom_subscriber = self.create_subscription(\n            Odometry,\n            \'odom\',\n            self.odom_callback,\n            10\n        )\n\n        self.goal_subscriber = self.create_subscription(\n            PoseStamped,\n            \'goal_pose\',\n            self.goal_callback,\n            10\n        )\n\n        # Navigation state\n        self.current_pose = None\n        self.current_goal = None\n        self.navigation_active = False\n\n        # Navigation timer\n        self.nav_timer = self.create_timer(0.05, self.navigation_callback)\n\n    def odom_callback(self, msg):\n        """Update current pose from odometry"""\n        self.current_pose = msg.pose.pose\n\n    def goal_callback(self, msg):\n        """Set new navigation goal"""\n        self.current_goal = msg.pose\n        self.navigation_active = True\n\n    def navigation_callback(self):\n        """Main navigation logic"""\n        if not self.navigation_active or not self.current_pose or not self.current_goal:\n            return\n\n        # Simple proportional controller\n        cmd_vel = Twist()\n\n        # Calculate distance to goal\n        dx = self.current_goal.position.x - self.current_pose.position.x\n        dy = self.current_goal.position.y - self.current_pose.position.y\n        distance = (dx**2 + dy**2)**0.5\n\n        # Calculate angle to goal\n        angle_to_goal = math.atan2(dy, dx)\n        current_yaw = self.get_yaw_from_quaternion(self.current_pose.orientation)\n        angle_diff = angle_to_goal - current_yaw\n\n        # Set velocity based on distance and angle\n        if distance > 0.1:  # Threshold for reaching goal\n            cmd_vel.linear.x = min(0.5, distance * 0.5)  # Forward speed\n            cmd_vel.angular.z = angle_diff * 1.0  # Turn speed\n        else:\n            cmd_vel.linear.x = 0.0\n            cmd_vel.angular.z = 0.0\n            self.navigation_active = False\n\n        self.cmd_vel_publisher.publish(cmd_vel)\n\n    def get_yaw_from_quaternion(self, q):\n        """Extract yaw from quaternion"""\n        siny_cosp = 2 * (q.w * q.z + q.x * q.y)\n        cosy_cosp = 1 - 2 * (q.y * q.y + q.z * q.z)\n        return math.atan2(siny_cosp, cosy_cosp)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"This chapter covered how to design Python AI agents that interface with ROS 2 using rclpy. We explored different patterns for AI agents, integration with machine learning, and best practices for safety and reliability. In the next chapter, we'll cover URDF design for humanoid robots."})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},3023(e,n,t){t.d(n,{R:()=>i,x:()=>o});var a=t(3696);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);